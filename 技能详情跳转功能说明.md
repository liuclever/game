# 技能详情跳转功能说明

## 功能描述
在游戏中的多个页面，点击技能名称或技能书名称时，可以跳转到技能详情页面，查看该技能的详细说明。

## 实现位置

### 1. 幻兽详情页面
**文件**: `interfaces/client/src/features/beast/BeastDetailPage.vue`

**修改内容**:
- 技能列表中的技能名称改为可点击链接
- 添加 `viewSkill(skillName)` 函数，点击后跳转到技能详情页

**代码示例**:
```vue
<!-- 技能显示 -->
<div class="section">
  技能:
  <template v-for="(skill, index) in beast.skills" :key="index">
    <a class="link" @click="viewSkill(skill)">{{ skill }}</a>
    <template v-if="index < beast.skills.length - 1"> | </template>
  </template>
  | <a class="link" @click="learnSkill">打书</a>
</div>

<!-- 跳转函数 -->
<script>
const viewSkill = (skillName) => {
  router.push(`/handbook/skill/${encodeURIComponent(skillName)}`)
}
</script>
```

### 2. 技能书页面
**文件**: `interfaces/client/src/features/beast/SkillBookPage.vue`

**修改内容**:
- 技能书名称改为可点击链接
- 添加 `viewSkill(skillName)` 函数
- 自动从技能书名称中提取技能名称（去掉"书"字）

**代码示例**:
```vue
<!-- 技能书显示 -->
<div v-for="book in skillBooks" :key="book.id" class="section book-item">
  技能书:<a class="link skill-name" @click="viewSkill(book.name)">{{ book.name }}</a>×{{ book.quantity }}
  <a class="link use-btn" @click="useSkillBook(book)">使用</a>
</div>

<!-- 跳转函数 -->
<script>
const viewSkill = (skillName) => {
  // 从技能书名称中提取技能名称（去掉"书"字）
  const cleanSkillName = skillName.replace(/书$/, '')
  router.push(`/handbook/skill/${encodeURIComponent(cleanSkillName)}`)
}
</script>
```

### 3. 闯塔幻兽详情页面
**文件**: `interfaces/client/src/features/tower/BeastDetailPage.vue`

**修改内容**:
- 技能列表中的技能名称改为可点击链接
- 添加 `viewSkill(skillName)` 函数

**代码示例**:
```vue
<!-- 技能显示 -->
<div class="section">
  技能: 
  <template v-for="(skill, idx) in safeSkills" :key="idx">
    <a class="link" @click="viewSkill(skill)">{{ skill }}</a>
    <template v-if="idx < safeSkills.length - 1"> | </template>
  </template>
</div>

<!-- 跳转函数 -->
<script>
const viewSkill = (skillName) => {
  router.push(`/handbook/skill/${encodeURIComponent(skillName)}`)
}
</script>
```

## 后端支持

### 技能查询增强
**文件**: `infrastructure/config/handbook_repo_from_config.py`

**修改内容**:
- 修改 `get_skill_detail()` 方法，支持通过技能名称查询
- 查询逻辑：先通过key查找，如果找不到则通过名称查找

**代码实现**:
```python
def get_skill_detail(self, skill_key: str) -> Optional[HandbookSkillInfo]:
    self._ensure_latest()
    key = str(skill_key or "").strip()
    if not key:
        return None
    
    # 首先尝试通过key查找
    skill = self._skills_by_key.get(key)
    if skill:
        return skill
    
    # 如果通过key找不到，尝试通过名称查找
    for skill_info in self._skills_by_key.values():
        if skill_info.name == key:
            return skill_info
    
    return None
```

## 技能详情页面

### 路由配置
**路由**: `/handbook/skill/:key`
**页面**: `interfaces/client/src/features/handbook/HandbookSkillDetailPage.vue`

### 页面功能
- 显示技能名称
- 显示技能描述
- 提供返回按钮

### 参数说明
- `key`: 可以是技能的key（如"gjcz"）或技能名称（如"高级冲撞"）
- 后端会自动识别并查找对应的技能信息

## 用户体验

### 跳转流程
1. 用户在幻兽详情页面看到技能列表
2. 点击任意技能名称（如"必杀"）
3. 跳转到技能详情页面，显示该技能的详细说明
4. 可以点击"返回前页"回到原页面

### 技能书跳转
1. 用户在技能书页面看到技能书列表
2. 点击技能书名称（如"必杀书"）
3. 自动提取技能名称（"必杀"）
4. 跳转到技能详情页面

## 技能数据结构

### 技能配置
技能信息存储在 `configs/handbook.json` 中：
```json
{
  "skills": {
    "bj": {
      "name": "必杀",
      "desc": "有一定几率触发，造成物理攻击150%的伤害",
      "source_url": ""
    },
    "gjbj": {
      "name": "高级必杀",
      "desc": "有较高几率触发，造成物理攻击180%的伤害",
      "source_url": ""
    }
  }
}
```

### 技能书配置
技能书信息存储在 `configs/skill_books.json` 中：
```json
{
  "skill_books": {
    "active_normal": [
      {
        "item_id": 10001,
        "name": "必杀书",
        "skill_name": "必杀",
        "description": "教会幻兽【必杀】技能"
      }
    ]
  }
}
```

## 注意事项

1. **URL编码**: 技能名称包含中文，需要使用 `encodeURIComponent()` 进行URL编码
2. **名称匹配**: 后端支持通过技能名称精确匹配查找技能信息
3. **技能书处理**: 技能书名称需要去掉"书"字后缀才能匹配到技能
4. **兼容性**: 同时支持通过key和名称查询，保证向后兼容

## 测试建议

### 测试场景
1. **幻兽详情页面**
   - 进入任意幻兽详情页面
   - 点击技能列表中的技能名称
   - 确认跳转到技能详情页面
   - 确认显示正确的技能信息

2. **技能书页面**
   - 进入技能书页面
   - 点击技能书名称
   - 确认跳转到对应技能的详情页面
   - 确认技能名称正确（去掉了"书"字）

3. **闯塔幻兽详情**
   - 在闯塔页面查看幻兽详情
   - 点击技能名称
   - 确认跳转到技能详情页面

4. **返回功能**
   - 从各个页面跳转到技能详情后
   - 点击"返回前页"
   - 确认能正确返回原页面

## 相关文件

### 前端文件
- `interfaces/client/src/features/beast/BeastDetailPage.vue` - 幻兽详情页面
- `interfaces/client/src/features/beast/SkillBookPage.vue` - 技能书页面
- `interfaces/client/src/features/tower/BeastDetailPage.vue` - 闯塔幻兽详情页面
- `interfaces/client/src/features/handbook/HandbookSkillDetailPage.vue` - 技能详情页面

### 后端文件
- `infrastructure/config/handbook_repo_from_config.py` - 技能查询逻辑
- `application/services/handbook_service.py` - 技能服务
- `interfaces/routes/handbook_routes.py` - 技能路由

### 配置文件
- `configs/handbook.json` - 技能配置
- `configs/skill_books.json` - 技能书配置
