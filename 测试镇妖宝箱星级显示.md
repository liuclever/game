# 测试镇妖宝箱星级显示

## 自动化测试

运行测试脚本：

```bash
python test_zhenyao_chest_star_display.py
```

该脚本会自动测试所有等级段的宝箱星级显示。

## 手动测试步骤

### 1. 准备测试账号

选择不同等级的测试账号：
- 30-39级账号（例如：35级）
- 40-49级账号（例如：45级）
- 50-59级账号（例如：55级）
- 60-69级账号（例如：65级）
- 70-79级账号（例如：75级）
- 80级及以上账号（例如：85级）

### 2. 添加宝箱到背包

使用数据库或管理工具为测试账号添加宝箱：

```sql
-- 添加试炼宝箱
INSERT INTO player_inventory (user_id, item_id, quantity, is_temporary) 
VALUES (玩家ID, 92001, 1, 0);

-- 添加炼狱宝箱
INSERT INTO player_inventory (user_id, item_id, quantity, is_temporary) 
VALUES (玩家ID, 92002, 1, 0);
```

或者通过镇妖系统获得宝箱。

### 3. 查看背包

登录测试账号，打开背包界面，查看宝箱名称：

#### 预期结果

| 玩家等级 | 试炼宝箱显示 | 炼狱宝箱显示 |
|---------|------------|------------|
| 30-39级 | 三星试炼宝箱 | 三星炼狱宝箱 |
| 40-49级 | 四星试炼宝箱 | 四星炼狱宝箱 |
| 50-59级 | 五星试炼宝箱 | 五星炼狱宝箱 |
| 60-69级 | 六星试炼宝箱 | 六星炼狱宝箱 |
| 70-79级 | 七星试炼宝箱 | 七星炼狱宝箱 |
| 80级以上 | 八星试炼宝箱 | 八星炼狱宝箱 |

### 4. 测试临时背包

将宝箱添加到临时背包：

```sql
-- 添加到临时背包
INSERT INTO player_inventory (user_id, item_id, quantity, is_temporary) 
VALUES (玩家ID, 92001, 1, 1);
```

查看临时背包，确认宝箱也显示星级。

### 5. 测试等级变化

1. 选择一个接近等级边界的账号（例如39级）
2. 查看背包中的宝箱名称（应该是"三星试炼宝箱"）
3. 将玩家升级到40级
4. 刷新背包，查看宝箱名称（应该变成"四星试炼宝箱"）

```sql
-- 升级玩家
UPDATE player SET level = 40, exp = 0 WHERE user_id = 玩家ID;
```

### 6. 测试镇妖获得宝箱

1. 登录测试账号
2. 进入镇妖界面
3. 占领一个层数（试炼层或炼狱层）
4. 等待占领到期（或手动修改数据库）
5. 查看背包，确认获得的宝箱显示正确的星级

## 验证要点

- ✓ 宝箱名称显示正确的星级前缀
- ✓ 星级使用中文数字（三、四、五、六、七、八）
- ✓ 正式背包和临时背包都显示星级
- ✓ 玩家升级后星级自动更新
- ✓ 宝箱功能正常（可以打开，获得奖励）

## 常见问题

### Q: 背包中的宝箱没有显示星级？

A: 检查以下几点：
1. 确认玩家等级是否达到30级（30级以下不显示星级）
2. 确认后端代码已更新（`interfaces/routes/inventory_routes.py`）
3. 确认前端已刷新（清除缓存或强制刷新）

### Q: 星级显示错误？

A: 检查玩家等级是否正确，星级规则如下：
- 30-39级 → 三星
- 40-49级 → 四星
- 50-59级 → 五星
- 60-69级 → 六星
- 70-79级 → 七星
- 80级以上 → 八星

### Q: 升级后星级没有更新？

A: 刷新背包界面，星级是动态计算的，刷新后会自动更新。

## 测试完成标准

- [ ] 所有等级段的宝箱星级显示正确
- [ ] 正式背包显示星级
- [ ] 临时背包显示星级
- [ ] 玩家升级后星级自动更新
- [ ] 宝箱可以正常打开
- [ ] 宝箱内容正确（根据等级获得相应奖励）
