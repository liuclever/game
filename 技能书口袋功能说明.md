# 技能书口袋功能说明

## 功能概述

技能书口袋是一个特殊的消耗品道具，打开后可以随机获得53个技能书中的一个。

## 道具信息

- **道具ID**: 6007
- **道具名称**: 技能书口袋
- **道具类型**: consumable（消耗品）
- **描述**: 开启获得随机技能书
- **可堆叠**: 是
- **最大堆叠数**: 9999
- **批量使用**: 支持，一次最多10个

## 技能书列表

技能书口袋可以随机获得以下53个技能书之一（等概率）：

### 主动技能 - 普通 (13个)
1. 必杀书 (ID: 10001) - 教会幻兽【必杀】技能
2. 连击书 (ID: 10002) - 教会幻兽【连击】技能
3. 破甲书 (ID: 10003) - 教会幻兽【破甲】技能
4. 致盲书 (ID: 10004) - 教会幻兽【致盲】技能
5. 麻痹书 (ID: 10005) - 教会幻兽【麻痹】技能
6. 迷惑书 (ID: 10006) - 教会幻兽【迷惑】技能
7. 虚弱书 (ID: 10007) - 教会幻兽【虚弱】技能
8. 雷击书 (ID: 10008) - 教会幻兽【雷击】技能
9. 撕咬书 (ID: 10009) - 教会幻兽【撕咬】技能
10. 冲撞书 (ID: 10010) - 教会幻兽【冲撞】技能
11. 水攻书 (ID: 10011) - 教会幻兽【水攻】技能
12. 吸血书 (ID: 10012) - 教会幻兽【吸血】技能
13. 毒攻书 (ID: 10013) - 教会幻兽【毒攻】技能

### 主动技能 - 高级 (13个)
14. 高级必杀书 (ID: 10101) - 教会幻兽【高级必杀】技能
15. 高级连击书 (ID: 10102) - 教会幻兽【高级连击】技能
16. 高级破甲书 (ID: 10103) - 教会幻兽【高级破甲】技能
17. 高级致盲书 (ID: 10104) - 教会幻兽【高级致盲】技能
18. 高级麻痹书 (ID: 10105) - 教会幻兽【高级麻痹】技能
19. 高级迷惑书 (ID: 10106) - 教会幻兽【高级迷惑】技能
20. 高级虚弱书 (ID: 10107) - 教会幻兽【高级虚弱】技能
21. 高级雷击书 (ID: 10108) - 教会幻兽【高级雷击】技能
22. 高级撕咬书 (ID: 10109) - 教会幻兽【高级撕咬】技能
23. 高级冲撞书 (ID: 10110) - 教会幻兽【高级冲撞】技能
24. 高级水攻书 (ID: 10111) - 教会幻兽【高级水攻】技能
25. 高级吸血书 (ID: 10112) - 教会幻兽【高级吸血】技能
26. 高级毒攻书 (ID: 10113) - 教会幻兽【高级毒攻】技能

### 被动技能 - 普通 (3个)
27. 闪避书 (ID: 10201) - 教会幻兽【闪避】技能
28. 反震书 (ID: 10202) - 教会幻兽【反震】技能
29. 反击书 (ID: 10203) - 教会幻兽【反击】技能

### 被动技能 - 高级 (3个)
30. 高级闪避书 (ID: 10301) - 教会幻兽【高级闪避】技能
31. 高级反震书 (ID: 10302) - 教会幻兽【高级反震】技能
32. 高级反击书 (ID: 10303) - 教会幻兽【高级反击】技能

### 增益技能 - 普通 (9个)
33. 强力书 (ID: 10401) - 教会幻兽【强力】技能
34. 智慧书 (ID: 10402) - 教会幻兽【智慧】技能
35. 魔抗书 (ID: 10403) - 教会幻兽【魔抗】技能
36. 防御书 (ID: 10404) - 教会幻兽【防御】技能
37. 敏捷书 (ID: 10405) - 教会幻兽【敏捷】技能
38. 体魄书 (ID: 10406) - 教会幻兽【体魄】技能
39. 幸运书 (ID: 10407) - 教会幻兽【幸运】技能
40. 偷袭书 (ID: 10408) - 教会幻兽【偷袭】技能
41. 抗性增强书 (ID: 10409) - 教会幻兽【抗性增强】技能

### 增益技能 - 高级 (8个)
42. 高级强力书 (ID: 10501) - 教会幻兽【高级强力】技能
43. 高级智慧书 (ID: 10502) - 教会幻兽【高级智慧】技能
44. 高级魔抗书 (ID: 10503) - 教会幻兽【高级魔抗】技能
45. 高级防御书 (ID: 10504) - 教会幻兽【高级防御】技能
46. 高级敏捷书 (ID: 10505) - 教会幻兽【高级敏捷】技能
47. 高级体魄书 (ID: 10506) - 教会幻兽【高级体魄】技能
48. 毒攻强化书 (ID: 10507) - 教会幻兽【毒攻强化】技能
49. 高级幸运书 (ID: 10508) - 教会幻兽【高级幸运】技能

### 减益技能 (4个)
50. 弱点攻击书 (ID: 10601) - 教会幻兽【弱点攻击】技能（负面）
51. 弱点防御书 (ID: 10602) - 教会幻兽【弱点防御】技能（负面）
52. 弱点魔抗书 (ID: 10603) - 教会幻兽【弱点魔抗】技能（负面）
53. 弱点敏捷书 (ID: 10604) - 教会幻兽【弱点敏捷】技能（负面）

## 使用方式

1. **单个使用**: 在背包中选择技能书口袋，点击使用，消耗1个技能书口袋，随机获得1本技能书
2. **批量使用**: 可以一次性使用多个技能书口袋（最多10个），每个口袋独立随机获得技能书

## 实现细节

### 代码位置
- 道具配置: `configs/items.json` (ID: 6007)
- 技能书配置: `configs/skill_books.json`
- 技能配置: `configs/skills.json`
- 使用逻辑: `application/services/inventory_service.py` (use_item方法)

### 随机算法
```python
# 从配置文件读取所有技能书
cfg_path = os.path.join(os.path.dirname(__file__), '..', '..', 'configs', 'skill_books.json')
with open(cfg_path, 'r', encoding='utf-8') as f:
    cfg = json.load(f)

# 收集所有技能书ID
all_books = []
for _, books in (cfg.get('skill_books', {}) or {}).items():
    for b in books or []:
        if b and b.get('item_id'):
            all_books.append(int(b['item_id']))

# 随机选择一本技能书
selected_book_id = random.choice(all_books)
```

### 概率分布
- 每个技能书的获得概率: 1/53 ≈ 1.89%
- 所有技能书等概率获得
- 不受玩家等级、VIP等级等因素影响

## 测试验证

运行测试脚本验证功能：
```bash
python test_skill_book_pouch.py
```

测试内容：
1. 验证技能书配置（53个技能书）
2. 验证道具配置（技能书口袋ID: 6007）
3. 验证所有技能书道具存在

## 注意事项

1. 技能书口袋和技能书是两个不同的道具
2. 技能书口袋是消耗品，使用后消失
3. 获得的技能书会添加到玩家背包
4. 技能书可以用于给幻兽学习技能
5. 支持批量打开，但一次最多10个
6. 每次打开都是独立随机，不保证不重复

## 相关文档

- 技能系统文档: `configs/skills.json`
- 技能书系统文档: `configs/skill_books.json`
- 道具系统文档: `configs/items.json`
- 背包系统文档: `商城购买 + 背包核销机制.txt`
