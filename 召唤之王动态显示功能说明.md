# 召唤之王动态显示功能说明

## 需求
召唤之王是正赛冠军，主页应该显示当前召唤之王的昵称，而不是写死的"低调"。
- 每当决出冠军，召唤之王则易位
- 如果还没有冠军，则显示为空（"虚位以待"）

## 实现方案

### 后端修改

**文件**：`interfaces/routes/king_routes.py`

**接口**：`GET /api/king/info`

**新增逻辑**：
```python
# 查询当前召唤之王（正赛冠军）
king_rows = execute_query(
    "SELECT user_id, nickname FROM player WHERE is_summon_king = 1 LIMIT 1"
)
summon_king_name = king_rows[0]['nickname'] if king_rows else None
summon_king_id = king_rows[0]['user_id'] if king_rows else None
```

**返回数据**：
```json
{
  "ok": true,
  "summonKingName": "玩家昵称",  // 如果没有冠军则为 null
  "summonKingId": 123,           // 玩家ID，用于跳转
  ...
}
```

### 前端修改

**文件**：`interfaces/client/src/features/king/SummonKingChallengePage.vue`

**新增状态**：
```javascript
const summonKingName = ref(null)
const summonKingId = ref(null)
```

**加载数据**：
```javascript
summonKingName.value = res.data.summonKingName || null
summonKingId.value = res.data.summonKingId || null
```

**显示逻辑**：
```vue
<div class="section">
  召唤之王：
  <a v-if="summonKingName" class="link blue" @click="viewPlayer(summonKingId)">{{ summonKingName }}</a>
  <span v-else class="gray">虚位以待</span>
</div>
```

- 有冠军时：显示为蓝色超链接，点击跳转到玩家信息页面
- 无冠军时：显示灰色文字"虚位以待"

## 冠军标识机制

### 设置冠军
在正赛决赛结束后，`king_final_service.py` 的 `run_final_stage()` 函数会：

```python
if next_stage == 'champion':
    champion_id = winners[0] if winners else None
    if champion_id:
        # 更新冠军标识
        execute_update(
            "UPDATE player SET is_summon_king = 1 WHERE user_id = %s",
            (champion_id,)
        )
        # 清除其他人的冠军标识
        execute_update(
            "UPDATE player SET is_summon_king = 0 WHERE user_id != %s",
            (champion_id,)
        )
```

### 冠军易位
- 每周五16:00执行半决赛，决出新冠军
- 新冠军的 `is_summon_king` 设为 1
- 旧冠军的 `is_summon_king` 自动设为 0
- 主页实时显示最新冠军昵称

## 显示效果

### 有冠军时
```
召唤之王：张三
```
（蓝色超链接，点击跳转到玩家信息页面）

### 无冠军时
```
召唤之王：虚位以待
```
（灰色文字，不可点击）

## 测试场景

1. **首次启动**：没有冠军，显示"虚位以待"
2. **决出冠军**：周五16:00正赛结束后，显示冠军昵称
3. **冠军易位**：下周正赛结束后，显示新冠军昵称
4. **实时更新**：刷新页面即可看到最新冠军

## 数据库字段

**表**：`player`

**字段**：`is_summon_king`
- 类型：`TINYINT(1)`
- 默认值：`0`
- 说明：`1` 表示当前召唤之王，`0` 表示普通玩家
- 约束：全服只有一个玩家的值为 `1`

## 总结

修改后，召唤之王主页会动态显示当前正赛冠军的昵称，每周正赛结束后自动更新，符合"召唤之王易位"的逻辑。
