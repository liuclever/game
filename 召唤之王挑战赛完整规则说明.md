# 召唤之王挑战赛完整规则说明

## 概述
召唤之王挑战赛是一个每周举行的PVP竞技活动，分为预选赛和正赛两个阶段。

## 参赛资格
- **等级要求：** 玩家达到20级可参加挑战赛

## 赛制结构

### 预选赛阶段

#### 报名时间
- **时间：** 每周一 0:00 - 23:59
- **方式：** 玩家主动报名参加本周挑战赛

#### 比赛时间
- **开始：** 每周二 0:00
- **结束：** 每周四 24:00（持续3天）

#### 比赛规则
1. **匹配机制**
   - 主动挑战匹配对手
   - 只能挑战排名比自己高的玩家
   - 分为两个赛区，每个赛区独立排名

2. **排名变化**
   - **胜利：** 排名上升（与对手交换排名）
   - **失败：** 排名不变

3. **挑战次数**
   - 每天有15次免费挑战
   - 可使用战令增加挑战次数

4. **冷却时间**
   - 每次挑战后有60秒冷却时间
   - 冷却后才可继续挑战

5. **奖励**
   - **胜利：** 获得20,000铜钱
   - **失败：** 获得2,000铜钱

#### 晋级规则
- 每周四 24:00 预选赛结束
- 各赛区前32名玩家进入正赛
- 共64名玩家进入正赛（2个赛区 × 32名）

### 正赛阶段

#### 赛程安排
| 时间 | 阶段 | 说明 |
|------|------|------|
| 周五 12:00 | 32强赛 | 64进32 |
| 周五 13:00 | 16强赛 | 32进16 |
| 周五 14:00 | 8强赛 | 16进8 |
| 周五 15:00 | 4强赛（半决赛） | 8进4 |
| 周五 16:00 | 2强赛（决赛） | 4进2 |
| 周五 17:00 | 冠军赛 | 2进1，决出冠军 |

#### 比赛规则
- 系统自动匹配对手
- 单败淘汰制
- 失败即淘汰，无法继续参赛

#### 正赛奖励

| 名次 | 奖励 |
|------|------|
| 冠军（第1名） | 铜钱450,000 + 特殊道具 |
| 亚军（第2名） | 铜钱350,000 + 特殊道具 |
| 4强（第3-4名） | 铜钱250,000 + 特殊道具 |
| 8强（第5-8名） | 铜钱150,000 + 特殊道具 |
| 16强（第9-16名） | 铜钱100,000 + 特殊道具 |
| 32强（第17-32名） | 铜钱50,000 + 特殊道具 |

**注意：** 正赛奖励需要在本周内领取，下周一 0:00 后将无法领取

## 完整时间线

### 周一（报名日）
- 0:00 - 23:59：预选赛报名时间
- 玩家可以报名参加本周挑战赛

### 周二（预选赛第1天）
- 0:00：预选赛正式开始
- 玩家可以开始挑战，争夺排名

### 周三（预选赛第2天）
- 继续预选赛
- 玩家继续挑战，提升排名

### 周四（预选赛第3天/最后一天）
- 继续预选赛
- 24:00：预选赛结束
- 各赛区前32名晋级正赛

### 周五（正赛日）
- 12:00：32强赛
- 13:00：16强赛
- 14:00：8强赛
- 15:00：4强赛（半决赛）
- 16:00：2强赛（决赛）
- 17:00：冠军赛，决出冠军

### 周六-周日
- 玩家可以领取正赛奖励
- 准备下周的挑战赛

### 下周一
- 0:00：上周奖励无法领取
- 0:00 - 23:59：新一周报名开始

## 赛区系统

### 赛区分配
- 系统自动分配玩家到两个赛区
- 保证两个赛区人数基本一致
- 新玩家首次参赛时自动分配

### 赛区规则
- 只能挑战同赛区的玩家
- 不能跨赛区挑战
- 每个赛区独立排名

## 战斗机制

### 挑战规则
1. 只能挑战排名比自己高的玩家
2. 不能挑战自己
3. 不能跨赛区挑战
4. 每天最多15次免费挑战
5. 每次挑战后60秒冷却

### 战斗系统
- 使用真实的PVP战斗引擎
- 双方使用出战幻兽进行战斗
- 战斗结果决定排名变化

### 排名变化
- **挑战者胜利：** 挑战者排名上升到被挑战者的排名，被挑战者排名下降到挑战者原排名
- **挑战者失败：** 双方排名不变

## 奖励系统

### 预选赛奖励
- **每次挑战都有奖励**
  - 胜利：20,000铜钱
  - 失败：2,000铜钱
- 即时发放，无需领取

### 正赛奖励
- **需要手动领取**
- **领取时间：** 周五正赛结束后 - 下周一 0:00 前
- **过期处理：** 下周一 0:00 后无法领取
- **奖励内容：** 根据最终排名发放铜钱和特殊道具

## 特殊规则

### 等级限制
- 必须达到20级才能参加
- 低于20级无法报名和挑战

### 报名限制
- 只能在周一报名
- 错过报名时间无法参加本周挑战赛
- 报名后不能取消

### 挑战限制
- 每天15次免费挑战
- 冷却时间60秒
- 必须有出战幻兽

### 正赛限制
- 只有预选赛前32名才能参加
- 正赛为系统自动匹配，无法选择对手
- 单败淘汰，失败即结束

## 策略建议

### 预选赛策略
1. **合理分配挑战次数**
   - 每天15次，3天共45次
   - 优先挑战排名接近的对手
   - 避免挑战过强的对手

2. **把握挑战时机**
   - 注意冷却时间
   - 选择合适的时间段挑战
   - 避开高峰期，减少被挑战次数

3. **保持连胜**
   - 连胜可以提升士气
   - 连胜记录会显示在排名中

### 正赛策略
1. **提前准备**
   - 确保幻兽状态最佳
   - 调整最强阵容
   - 了解对手实力

2. **及时领取奖励**
   - 正赛结束后尽快领取
   - 避免过期无法领取

## 常见问题

### Q1: 如何报名参加挑战赛？
A: 在周一（0:00-23:59）期间，进入召唤之王挑战赛页面，点击"报名"按钮。

### Q2: 错过报名时间怎么办？
A: 只能等待下周一重新报名，本周无法参加。

### Q3: 预选赛排名如何计算？
A: 根据挑战结果实时更新，胜利者排名上升，失败者排名不变。

### Q4: 如何进入正赛？
A: 预选赛结束时（周四24:00），各赛区前32名自动晋级正赛。

### Q5: 正赛奖励什么时候领取？
A: 正赛结束后（周五17:00后）至下周一0:00前领取。

### Q6: 正赛奖励过期了怎么办？
A: 下周一0:00后无法领取，奖励作废。

### Q7: 可以更换赛区吗？
A: 不可以，赛区由系统自动分配，无法更换。

### Q8: 挑战次数用完了怎么办？
A: 可以使用战令增加挑战次数（如果有此功能）。

### Q9: 冷却时间可以跳过吗？
A: 不可以，必须等待60秒冷却时间结束。

### Q10: 正赛是自动进行的吗？
A: 是的，正赛由系统自动匹配和进行，玩家无需手动操作。

## 技术实现

### 数据库表
- `king_challenge_rank` - 玩家排名记录
- `king_challenge_logs` - 挑战记录
- `king_reward_claimed` - 奖励领取记录

### 关键常量
```python
KING_DAILY_MAX_CHALLENGES = 15  # 每日最大挑战次数
KING_CHALLENGE_COOLDOWN = 60    # 挑战冷却时间（秒）
KING_WIN_REWARD = 20000          # 胜利奖励
KING_LOSE_REWARD = 2000          # 失败奖励
```

### 关键接口
- `GET /api/king/info` - 获取挑战赛信息
- `POST /api/king/challenge` - 发起挑战
- `POST /api/king/register` - 报名参赛
- `GET /api/king/ranking` - 获取排名
- `GET /api/king/reward_info` - 获取奖励信息
- `POST /api/king/claim_reward` - 领取奖励
- `GET /api/king/dynamics` - 获取动态

## 总结

召唤之王挑战赛是一个完整的周赛系统，包含：
- ✅ 等级限制（20级）
- ✅ 报名机制（周一）
- ✅ 预选赛（周二-周四）
- ✅ 正赛（周五）
- ✅ 挑战次数限制（15次/天）
- ✅ 冷却时间（60秒）
- ✅ 排名系统
- ✅ 奖励系统
- ✅ 赛区系统

该系统已经完整实现，可以正常运行。

**文档创建时间：** 2026-01-18  
**状态：** ✅ 完整记录
