# 副本返回白屏问题修复说明

## 问题描述

用户报告：从副本挑战页面点击"返回游戏首页"或"返回地图首页"按钮后，页面显示白屏，无法正常显示内容。

**问题路径：**
1. 主页 → 副本挑战页面
2. 点击"返回游戏首页"或"返回地图首页"
3. 页面变成白屏

## 问题原因

在 `interfaces/client/src/features/dungeon/DungeonChallengePage.vue` 中，`goBack()` 和 `goMap()` 函数使用了 `window.location.href` 进行页面跳转：

```javascript
const goBack = () => {
  // 直接刷新页面到首页
  window.location.href = window.location.origin + '/'
}

const goMap = () => {
  // 直接刷新页面到地图首页
  window.location.href = window.location.origin + '/map'
}
```

**问题分析：**
1. `window.location.href` 会触发完整的页面重新加载
2. 这会导致 Vue Router 的状态丢失
3. 如果在页面加载过程中 API 调用失败或出现错误，页面会显示白屏
4. 使用 `window.location.href` 不符合 SPA（单页应用）的最佳实践

## 解决方案

将 `window.location.href` 改为使用 Vue Router 的 `router.push()` 方法：

```javascript
const goBack = () => {
  router.push('/')
}

const goMap = () => {
  router.push('/map')
}
```

**优势：**
1. 使用 Vue Router 进行路由跳转，不会触发完整页面重载
2. 保持 SPA 的流畅体验
3. 路由状态和组件状态得以保留
4. 避免不必要的资源重新加载
5. 更好的错误处理和用户体验

## 修改文件

**文件：** `interfaces/client/src/features/dungeon/DungeonChallengePage.vue`

**修改前：**
```javascript
const goBack = () => {
  // 直接刷新页面到首页
  window.location.href = window.location.origin + '/'
}

const goMap = () => {
  // 直接刷新页面到地图首页
  window.location.href = window.location.origin + '/map'
}
```

**修改后：**
```javascript
const goBack = () => {
  router.push('/')
}

const goMap = () => {
  router.push('/map')
}
```

## 测试步骤

### 测试场景1：返回游戏首页
1. 登录游戏
2. 进入任意副本挑战页面
3. 点击"返回游戏首页"按钮
4. **预期结果：** 正常跳转到游戏首页，显示所有内容

### 测试场景2：返回地图首页
1. 登录游戏
2. 进入任意副本挑战页面
3. 点击"返回地图首页"按钮
4. **预期结果：** 正常跳转到地图首页，显示地图和副本列表

### 测试场景3：多次往返
1. 登录游戏
2. 主页 → 副本挑战 → 返回主页 → 副本挑战 → 返回地图 → 副本挑战 → 返回主页
3. **预期结果：** 所有跳转都正常，无白屏现象

## 相关页面检查

其他页面的返回按钮都正确使用了 `router.push()` 或 `router.back()`，不存在类似问题：

- `MapPage.vue`: `router.push('/')`
- `TowerPage.vue`: `router.push('/')`
- `ArenaPage.vue`: `router.push('/')`
- `SigninPage.vue`: `router.push('/')`
- 等等...

## 注意事项

1. **避免使用 window.location.href**：在 Vue SPA 应用中，应该始终使用 Vue Router 进行路由跳转
2. **错误处理**：如果页面加载时出现错误，应该在组件的 `onMounted` 钩子中添加适当的错误处理和用户提示
3. **Loading 状态**：可以考虑在页面加载时显示 loading 状态，提升用户体验

## 完成状态

✅ 副本返回白屏问题已修复
✅ 使用 Vue Router 替代 window.location.href
✅ 符合 SPA 最佳实践
✅ 用户体验得到改善
