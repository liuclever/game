# 通天塔鼓舞接口404问题修复

## 问题描述

浏览器控制台出现以下错误：

```
/api/tower/inspire/status: 404 (NOT FOUND)
加载鼓舞状态失败 AxiosError
```

## 问题原因

前端代码在 `TowerPage.vue` 中调用了 `/tower/inspire/status` 接口来获取鼓舞状态，但后端没有实现这个接口，导致返回404错误。

### 前端代码

**文件**：`interfaces/client/src/features/tower/TowerPage.vue`

**第92行**：
```javascript
const res = await http.get('/tower/inspire/status')
```

前端在页面加载时（`onMounted`）会自动调用这个接口。

### 后端缺失

**文件**：`interfaces/routes/tower_routes.py`

后端的通天塔路由中没有 `/tower/inspire/status` 接口。

## 鼓舞功能状态

从前端代码看，鼓舞功能的UI已经被注释掉了（第268-279行），但是加载鼓舞状态的代码仍然在运行。

**注释掉的UI**：
```vue
<!-- 鼓舞状态 -->
<!-- <div class="section" v-if="inspireStatus.active">
  鼓舞: <span class="green">生效中</span> 
  <span class="gray">(剩余{{ formatInspireTime }}，战力+10%)</span>
</div> -->
```

这说明鼓舞功能可能：
1. 正在开发中，尚未完成
2. 已经被废弃，但代码没有清理干净

## 解决方案

### 方案1：添加空接口（已实施）

在后端添加一个简单的接口，返回默认值，避免404错误。

**文件**：`interfaces/routes/tower_routes.py`

**添加位置**：闯塔接口部分（第65行之前）

**代码**：
```python
@tower_bp.get("/tower/inspire/status")
def get_inspire_status():
    """获取鼓舞状态（暂未实现，返回默认值）"""
    user_id = get_current_user_id()
    if not user_id:
        return jsonify({"ok": False, "error": "请先登录"}), 401
    
    # 鼓舞功能暂未实现，返回默认状态
    return jsonify({
        "ok": True,
        "active": False,
        "remaining_seconds": 0,
        "inspire_pill_count": 0
    })
```

**优点**：
- 简单快速
- 不影响现有功能
- 为将来实现鼓舞功能预留接口

**缺点**：
- 返回的是假数据

### 方案2：移除前端调用（备选）

如果鼓舞功能确定不需要了，可以在前端移除相关代码。

**需要修改**：
1. 移除 `loadInspireStatus()` 函数调用
2. 移除 `inspireStatus` 相关的代码
3. 移除 `useInspirePill()` 函数

## 测试验证

修复后：

1. **重启后端服务**
2. **刷新浏览器**
3. 打开通天塔页面
4. 检查浏览器控制台，应该不再有404错误

## 鼓舞功能说明

根据代码分析，鼓舞功能的设计是：

1. **鼓舞丹**：一种道具，可以激活鼓舞效果
2. **鼓舞效果**：
   - 持续一定时间（有倒计时）
   - 战力+10%
   - 不能叠加使用
3. **获取方式**：
   - 开启钛金宝箱
   - 开启秘银宝箱
   - 商城购买

## 相关文件

### 修改的文件
- `interfaces/routes/tower_routes.py` - 添加鼓舞状态接口

### 相关文件（未修改）
- `interfaces/client/src/features/tower/TowerPage.vue` - 前端调用代码
- `application/services/tower_service.py` - 后端服务（包含 `apply_buff` 方法）

## 后续建议

如果需要完整实现鼓舞功能，需要：

1. **数据库表**：
   - 存储玩家的鼓舞状态（是否激活、剩余时间）
   - 存储玩家的鼓舞丹数量

2. **后端接口**：
   - `GET /tower/inspire/status` - 获取鼓舞状态（已添加）
   - `POST /tower/inspire/use` - 使用鼓舞丹

3. **前端UI**：
   - 取消注释鼓舞状态显示
   - 添加使用鼓舞丹的按钮

4. **战斗逻辑**：
   - 在闯塔战斗中应用鼓舞加成（+10%战力）
   - `tower_service.py` 中已有 `apply_buff` 方法可以使用

## 修复日期

2026-01-23

---

**状态**: ✅ 已修复（添加空接口）
**影响**: 通天塔页面不再出现404错误
**测试**: 需要重启后端服务
