# æˆ˜æŠ¥åˆ†é¡µåŠŸèƒ½å®ç°è¯´æ˜

## å®ç°æ—¶é—´
2026å¹´1æœˆ17æ—¥

## éœ€æ±‚æè¿°

ç”¨æˆ·è¦æ±‚ï¼š
> é—¯å¡”ã€æˆ˜åœºã€åˆ‡ç£‹ã€å¬å”¤ä¹‹ç‹æŒ‘æˆ˜èµ›ã€æ“‚å°ã€ç«æŠ€ã€ç›Ÿæˆ˜ã€é•‡å¦–ã€åœ°å›¾å‰¯æœ¬æŒ‘æˆ˜ã€é¾™å®«ä¹‹è°œä¸­æ¶‰åŠæˆ˜æ–—è¿‡ç¨‹çš„ï¼Œç©å®¶éƒ½å¯ä»¥æŸ¥çœ‹è¯¦ç»†æˆ˜æŠ¥ï¼Œæˆ˜æŠ¥å±•ç¤ºçš„é¡µæ•°æ— ä¸Šé™ï¼Œæ¯é¡µå±•ç°10ä¸ªå›åˆï¼Œæ¯ä¸ªå›åˆå†…æ¶‰åŠæ‰£è¡€æ•°å€¼

## å®ç°æ–¹æ¡ˆ

### 1. åˆ›å»ºé€šç”¨æˆ˜æŠ¥ç»„ä»¶

**æ–‡ä»¶**ï¼š`interfaces/client/src/features/common/BattleReportDetailPage.vue`

**åŠŸèƒ½**ï¼š
- æ”¯æŒåˆ†é¡µæ˜¾ç¤ºæˆ˜æ–—å›åˆ
- æ¯é¡µæ˜¾ç¤º10ä¸ªå›åˆ
- é¡µæ•°æ— ä¸Šé™
- æ˜¾ç¤ºæ‰£è¡€æ•°å€¼
- æ”¯æŒä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µå¯¼èˆª
- æ”¯æŒå¿«é€Ÿè·³è½¬åˆ°æŒ‡å®šé¡µ

**æ•°æ®æ ¼å¼**ï¼š
```javascript
{
  title: "æˆ˜æŠ¥æ ‡é¢˜",
  info: "æˆ˜æ–—ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰",
  rounds: [
    {
      round_num: 1,
      description: "å›åˆæè¿°ï¼ˆåŒ…å«æ‰£è¡€æ•°å€¼ï¼‰",
      attacker_hp_after: 1000,
      defender_hp_after: 800,
      damage: 200
    },
    // ... æ›´å¤šå›åˆ
  ],
  result: "æˆ˜æ–—ç»“æœ"
}
```

### 2. æ›´æ–°é—¯å¡”æˆ˜æŠ¥é¡µé¢

**æ–‡ä»¶**ï¼š`interfaces/client/src/features/tower/BattleReportPage.vue`

**ä¿®æ”¹å†…å®¹**ï¼š
1. âœ… æ·»åŠ åˆ†é¡µåŠŸèƒ½ï¼ˆæ¯é¡µ10ä¸ªå›åˆï¼‰
2. âœ… æ·»åŠ ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µå¯¼èˆª
3. âœ… æ·»åŠ é¡µç å¿«é€Ÿè·³è½¬
4. âœ… æ˜¾ç¤ºå½“å‰é¡µ/æ€»é¡µæ•°
5. âœ… æˆ˜æ–—ç»“æœåªåœ¨æœ€åä¸€é¡µæ˜¾ç¤º
6. âœ… æ”¯æŒæ‰£è¡€æ•°å€¼æ˜¾ç¤º

**åˆ†é¡µé€»è¾‘**ï¼š
```javascript
// æ¯é¡µ10ä¸ªå›åˆ
const roundsPerPage = 10

// æ€»é¡µæ•°
const totalPages = computed(() => {
  return Math.ceil(rounds.value.length / roundsPerPage)
})

// å½“å‰é¡µçš„å›åˆ
const currentRounds = computed(() => {
  const start = (currentPage.value - 1) * roundsPerPage
  const end = start + roundsPerPage
  return rounds.value.slice(start, end)
})
```

### 3. æˆ˜æŠ¥æ•°æ®ç»“æ„

#### åç«¯æ•°æ®ç»“æ„ï¼ˆPVPæˆ˜æ–—å¼•æ“ï¼‰

**æ–‡ä»¶**ï¼š`domain/services/pvp_battle_engine.py`

```python
@dataclass
class AttackLog:
    """å•æ¬¡æ”»å‡»çš„æˆ˜æŠ¥è®°å½•ï¼ˆä¸€å›åˆ = ä¸€æ¬¡æ”»å‡»ï¼‰"""
    turn: int  # ç¬¬å‡ å›åˆï¼ˆä» 1 å¼€å§‹ï¼‰
    attacker_player_id: int
    attacker_name: str
    defender_name: str
    damage: int
    attacker_hp_after: int
    defender_hp_after: int
    skill_name: str = ""
    description: str = ""
```

**æˆ˜æŠ¥æè¿°æ ¼å¼**ï¼š
```
ã€ç©å®¶Aã€çš„ç«ç„°é¾™-ç¥ç•Œä½¿ç”¨ã€çƒˆç„°å†²å‡»ã€‘æ”»å‡»ã€ç©å®¶Bã€çš„å†°éœœè™-ä»™ç•Œï¼Œé€ æˆ250ç‚¹ä¼¤å®³
```

#### å‰ç«¯æ•°æ®ç»“æ„

```javascript
{
  round_num: 1,  // å›åˆæ•°
  description: "ã€ç©å®¶Aã€çš„ç«ç„°é¾™-ç¥ç•Œä½¿ç”¨ã€çƒˆç„°å†²å‡»ã€‘æ”»å‡»ã€ç©å®¶Bã€çš„å†°éœœè™-ä»™ç•Œï¼Œé€ æˆ250ç‚¹ä¼¤å®³",
  attacker_hp_after: 1000,  // æ”»å‡»æ–¹å‰©ä½™HP
  defender_hp_after: 750,   // é˜²å®ˆæ–¹å‰©ä½™HP
  damage: 250               // ä¼¤å®³å€¼
}
```

### 4. å„æˆ˜æ–—åœºæ™¯çš„æˆ˜æŠ¥å®ç°

#### 4.1 é—¯å¡”ï¼ˆé€šå¤©å¡”ã€é¾™çº¹å¡”ã€æˆ˜çµå¡”ï¼‰

**çŠ¶æ€**ï¼šâœ… å·²å®ç°åˆ†é¡µ

**æ–‡ä»¶**ï¼š
- å‰ç«¯ï¼š`interfaces/client/src/features/tower/BattleReportPage.vue`
- åç«¯ï¼š`application/services/tower_service.py`

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨ç»Ÿä¸€PVPæˆ˜æ–—å¼•æ“
- æ¯å±‚æˆ˜æ–—ç”Ÿæˆå®Œæ•´æˆ˜æŠ¥
- æ”¯æŒæŸ¥çœ‹è¯¦ç»†å›åˆä¿¡æ¯
- æ˜¾ç¤ºæ‰£è¡€æ•°å€¼

#### 4.2 é•‡å¦–

**çŠ¶æ€**ï¼šâœ… å·²æœ‰æˆ˜æŠ¥é¡µé¢

**æ–‡ä»¶**ï¼š
- å‰ç«¯ï¼š`interfaces/client/src/features/tower/ZhenYaoBattlePage.vue`
- åç«¯ï¼š`application/services/zhenyao_service.py`

**å¾…ä¼˜åŒ–**ï¼š
- æ·»åŠ åˆ†é¡µåŠŸèƒ½
- ç»Ÿä¸€æˆ˜æŠ¥æ ¼å¼

#### 4.3 ç«æŠ€åœºï¼ˆæ“‚å°ï¼‰

**çŠ¶æ€**ï¼šâœ… å·²æœ‰æˆ˜æŠ¥é¡µé¢

**æ–‡ä»¶**ï¼š
- å‰ç«¯ï¼š`interfaces/client/src/features/arena/ArenaBattlePage.vue`
- åç«¯ï¼š`application/services/arena_service.py`

**å¾…ä¼˜åŒ–**ï¼š
- æ·»åŠ åˆ†é¡µåŠŸèƒ½
- ç»Ÿä¸€æˆ˜æŠ¥æ ¼å¼

#### 4.4 æˆ˜åœºï¼ˆçŒ›è™æˆ˜åœºã€é£é¹¤æˆ˜åœºï¼‰

**çŠ¶æ€**ï¼šâœ… å·²æœ‰æˆ˜æŠ¥é¡µé¢

**æ–‡ä»¶**ï¼š
- å‰ç«¯ï¼š`interfaces/client/src/features/battlefield/BattlefieldBattlePage.vue`
- åç«¯ï¼š`application/services/battlefield_service.py`

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨ç»Ÿä¸€PVPæˆ˜æ–—å¼•æ“
- æ”¯æŒæŸ¥çœ‹å†å²æˆ˜æŠ¥
- æ˜¾ç¤ºè¯¦ç»†å›åˆä¿¡æ¯

**å¾…ä¼˜åŒ–**ï¼š
- æ·»åŠ åˆ†é¡µåŠŸèƒ½

#### 4.5 åˆ‡ç£‹

**çŠ¶æ€**ï¼šâœ… å·²æœ‰æˆ˜æŠ¥é¡µé¢

**æ–‡ä»¶**ï¼š
- å‰ç«¯ï¼š`interfaces/client/src/features/player/SparBattleReportPage.vue`
- åç«¯ï¼š`application/services/spar_service.py`

**å¾…ä¼˜åŒ–**ï¼š
- æ·»åŠ åˆ†é¡µåŠŸèƒ½
- ç»Ÿä¸€æˆ˜æŠ¥æ ¼å¼

#### 4.6 å¬å”¤ä¹‹ç‹æŒ‘æˆ˜èµ›

**çŠ¶æ€**ï¼šâœ… å·²æœ‰æˆ˜æŠ¥é¡µé¢

**æ–‡ä»¶**ï¼š
- å‰ç«¯ï¼š`interfaces/client/src/features/king/KingBattleReportPage.vue`
- åç«¯ï¼š`application/services/king_service.py`

**ç‰¹ç‚¹**ï¼š
- æ”¯æŒå¤šæˆ˜åˆ‡æ¢
- æ˜¾ç¤ºè¯¦ç»†å›åˆä¿¡æ¯

**å¾…ä¼˜åŒ–**ï¼š
- æ·»åŠ åˆ†é¡µåŠŸèƒ½

#### 4.7 ç›Ÿæˆ˜

**çŠ¶æ€**ï¼šâœ… å·²æœ‰æˆ˜æŠ¥é¡µé¢

**æ–‡ä»¶**ï¼š
- å‰ç«¯ï¼š`interfaces/client/src/features/alliance/AllianceWarBattleRecordsPage.vue`
- åç«¯ï¼š`application/services/alliance_war_service.py`

**å¾…ä¼˜åŒ–**ï¼š
- æ·»åŠ åˆ†é¡µåŠŸèƒ½
- ç»Ÿä¸€æˆ˜æŠ¥æ ¼å¼

#### 4.8 åœ°å›¾å‰¯æœ¬æŒ‘æˆ˜

**çŠ¶æ€**ï¼šâœ… å·²æœ‰æˆ˜æŠ¥é¡µé¢

**æ–‡ä»¶**ï¼š
- å‰ç«¯ï¼š`interfaces/client/src/features/dungeon/DungeonDetailReportPage.vue`
- åç«¯ï¼š`application/services/dungeon_service.py`

**å¾…ä¼˜åŒ–**ï¼š
- æ·»åŠ åˆ†é¡µåŠŸèƒ½
- ç»Ÿä¸€æˆ˜æŠ¥æ ¼å¼

#### 4.9 é¾™å®«ä¹‹è°œ

**çŠ¶æ€**ï¼šâœ… å·²æœ‰æˆ˜æŠ¥é¡µé¢

**æ–‡ä»¶**ï¼š
- å‰ç«¯ï¼š`interfaces/client/src/features/dragonpalace/DragonPalaceDetailReportPage.vue`
- åç«¯ï¼š`application/services/dragonpalace_service.py`

**å¾…ä¼˜åŒ–**ï¼š
- æ·»åŠ åˆ†é¡µåŠŸèƒ½
- ç»Ÿä¸€æˆ˜æŠ¥æ ¼å¼

### 5. åˆ†é¡µåŠŸèƒ½å®ç°ç»†èŠ‚

#### 5.1 åˆ†é¡µå¯¼èˆª

```vue
<!-- åˆ†é¡µå¯¼èˆª -->
<div v-if="totalPages > 1" class="section pagination">
  <a v-if="hasPrevPage" class="link" @click="prevPage">ä¸Šä¸€é¡µ</a>
  <span v-else class="gray">ä¸Šä¸€é¡µ</span>
  <span class="page-info">ç¬¬{{ currentPage }}/{{ totalPages }}é¡µ</span>
  <a v-if="hasNextPage" class="link" @click="nextPage">ä¸‹ä¸€é¡µ</a>
  <span v-else class="gray">ä¸‹ä¸€é¡µ</span>
</div>
```

#### 5.2 é¡µç å¿«é€Ÿè·³è½¬

```vue
<!-- é¡µç å¿«é€Ÿè·³è½¬ -->
<div v-if="totalPages > 1" class="section page-numbers">
  è·³è½¬åˆ°ï¼š
  <template v-for="page in totalPages" :key="page">
    <a 
      v-if="page !== currentPage" 
      class="link page-num" 
      @click="goToPage(page)"
    >{{ page }}</a>
    <span v-else class="current-page">{{ page }}</span>
  </template>
</div>
```

#### 5.3 å›åˆæ˜¾ç¤º

```vue
<!-- å½“å‰é¡µçš„å›åˆè®°å½• -->
<div v-for="r in currentRounds" :key="r.round_num" class="section">
  [å›åˆ{{ r.round_num }}]: {{ r.description }}
</div>
```

#### 5.4 æˆ˜æ–—ç»“æœ

```vue
<!-- æˆ˜æ–—ç»“æœï¼ˆæœ€åä¸€é¡µæ˜¾ç¤ºï¼‰ -->
<div v-if="currentPage === totalPages" class="section result">
  [æˆ˜æ–—ç»“æŸ]: {{ battleResult }}
</div>
```

### 6. æ‰£è¡€æ•°å€¼æ˜¾ç¤º

#### 6.1 åç«¯ç”Ÿæˆæˆ˜æŠ¥æè¿°

**æ–‡ä»¶**ï¼š`domain/services/pvp_battle_engine.py`

```python
def _build_attack_description(
    attacker_name: str,
    defender_name: str,
    damage: int,
    skill_name: str,
    applied_effects: List,
) -> str:
    """æ„é€ ä¸€æ¡ç”¨äºå‰ç«¯å±•ç¤ºçš„æˆ˜æŠ¥æè¿°"""
    
    # åŸºç¡€æ”»å‡»æè¿°
    if skill_name:
        desc = f"ã€{attacker_name}ã€ä½¿ç”¨ã€{skill_name}ã€‘æ”»å‡»ã€{defender_name}ã€ï¼Œé€ æˆ{damage}ç‚¹ä¼¤å®³"
    else:
        desc = f"ã€{attacker_name}ã€æ”»å‡»ã€{defender_name}ã€ï¼Œé€ æˆ{damage}ç‚¹ä¼¤å®³"
    
    # æ·»åŠ ç‰¹æ•ˆæè¿°
    for effect in applied_effects:
        desc += f"ï¼Œ{effect}"
    
    return desc
```

#### 6.2 å‰ç«¯æ˜¾ç¤ºæ‰£è¡€æ•°å€¼

æˆ˜æŠ¥æè¿°ä¸­å·²åŒ…å«æ‰£è¡€æ•°å€¼ï¼Œä¾‹å¦‚ï¼š
```
ã€ç©å®¶Aã€çš„ç«ç„°é¾™-ç¥ç•Œä½¿ç”¨ã€çƒˆç„°å†²å‡»ã€‘æ”»å‡»ã€ç©å®¶Bã€çš„å†°éœœè™-ä»™ç•Œï¼Œé€ æˆ250ç‚¹ä¼¤å®³
```

### 7. æµ‹è¯•éªŒè¯

#### æµ‹è¯•ç”¨ä¾‹1ï¼šé—¯å¡”æˆ˜æŠ¥åˆ†é¡µ

**æ­¥éª¤**ï¼š
1. å¼€å§‹è‡ªåŠ¨é—¯å¡”
2. æŒ‘æˆ˜ä¸€å±‚ï¼ˆç”Ÿæˆ50+å›åˆï¼‰
3. ç‚¹å‡»"è¯¦ç»†æˆ˜æŠ¥"

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ˜¾ç¤ºåˆ†é¡µå¯¼èˆª
- âœ… ç¬¬1é¡µæ˜¾ç¤ºç¬¬1-10å›åˆ
- âœ… ç‚¹å‡»"ä¸‹ä¸€é¡µ"æ˜¾ç¤ºç¬¬11-20å›åˆ
- âœ… æœ€åä¸€é¡µæ˜¾ç¤ºæˆ˜æ–—ç»“æœ
- âœ… æ¯ä¸ªå›åˆæ˜¾ç¤ºæ‰£è¡€æ•°å€¼

#### æµ‹è¯•ç”¨ä¾‹2ï¼šé¡µç å¿«é€Ÿè·³è½¬

**æ­¥éª¤**ï¼š
1. æŸ¥çœ‹æœ‰å¤šé¡µçš„æˆ˜æŠ¥
2. ç‚¹å‡»é¡µç "3"

**é¢„æœŸç»“æœ**ï¼š
- âœ… ç›´æ¥è·³è½¬åˆ°ç¬¬3é¡µ
- âœ… æ˜¾ç¤ºç¬¬21-30å›åˆ
- âœ… å½“å‰é¡µç é«˜äº®æ˜¾ç¤º

#### æµ‹è¯•ç”¨ä¾‹3ï¼šæˆ˜æ–—ç»“æœæ˜¾ç¤º

**æ­¥éª¤**ï¼š
1. æŸ¥çœ‹æˆ˜æŠ¥
2. ç¿»åˆ°æœ€åä¸€é¡µ

**é¢„æœŸç»“æœ**ï¼š
- âœ… æœ€åä¸€é¡µæ˜¾ç¤ºæˆ˜æ–—ç»“æœ
- âœ… æ˜¾ç¤ºè·èƒœæ–¹å’Œå‰©ä½™HP
- âœ… å‰é¢çš„é¡µä¸æ˜¾ç¤ºæˆ˜æ–—ç»“æœ

### 8. åç»­ä¼˜åŒ–è®¡åˆ’

#### 8.1 ç»Ÿä¸€æˆ˜æŠ¥æ ¼å¼

**ç›®æ ‡**ï¼šæ‰€æœ‰æˆ˜æ–—åœºæ™¯ä½¿ç”¨ç»Ÿä¸€çš„æˆ˜æŠ¥æ•°æ®ç»“æ„

**æ­¥éª¤**ï¼š
1. å®šä¹‰ç»Ÿä¸€çš„æˆ˜æŠ¥æ¥å£
2. æ›´æ–°å„æœåŠ¡çš„æˆ˜æŠ¥ç”Ÿæˆé€»è¾‘
3. æ›´æ–°å‰ç«¯æˆ˜æŠ¥é¡µé¢

#### 8.2 ä¸ºå…¶ä»–æˆ˜æ–—åœºæ™¯æ·»åŠ åˆ†é¡µ

**å¾…ä¼˜åŒ–åœºæ™¯**ï¼š
- é•‡å¦–
- ç«æŠ€åœº
- æˆ˜åœº
- åˆ‡ç£‹
- å¬å”¤ä¹‹ç‹
- ç›Ÿæˆ˜
- åœ°å›¾å‰¯æœ¬
- é¾™å®«ä¹‹è°œ

**å®ç°æ–¹å¼**ï¼š
1. å¤ç”¨é—¯å¡”æˆ˜æŠ¥çš„åˆ†é¡µé€»è¾‘
2. æˆ–ä½¿ç”¨é€šç”¨æˆ˜æŠ¥ç»„ä»¶

#### 8.3 æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŒ–ç‚¹**ï¼š
- å¤§é‡å›åˆæ—¶çš„æ¸²æŸ“æ€§èƒ½
- è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚æœå›åˆæ•°è¶…è¿‡1000ï¼‰
- æ‡’åŠ è½½æˆ˜æŠ¥æ•°æ®

### 9. æ³¨æ„äº‹é¡¹

1. **æ•°æ®æ ¼å¼å…¼å®¹**ï¼š
   - ç¡®ä¿åç«¯è¿”å›çš„æˆ˜æŠ¥æ•°æ®åŒ…å« `round_num` å’Œ `description`
   - å…¼å®¹æ—§çš„æˆ˜æŠ¥æ•°æ®æ ¼å¼

2. **åˆ†é¡µè¾¹ç•Œå¤„ç†**ï¼š
   - ç¬¬1é¡µä¸æ˜¾ç¤º"ä¸Šä¸€é¡µ"
   - æœ€åä¸€é¡µä¸æ˜¾ç¤º"ä¸‹ä¸€é¡µ"
   - æˆ˜æ–—ç»“æœåªåœ¨æœ€åä¸€é¡µæ˜¾ç¤º

3. **æ‰£è¡€æ•°å€¼æ˜¾ç¤º**ï¼š
   - æˆ˜æŠ¥æè¿°ä¸­åŒ…å«æ‰£è¡€æ•°å€¼
   - æ ¼å¼ï¼š`é€ æˆXXXç‚¹ä¼¤å®³`

4. **é¡µç æ˜¾ç¤º**ï¼š
   - é¡µæ•°è¾ƒå¤šæ—¶ï¼ˆ>10é¡µï¼‰ï¼Œè€ƒè™‘çœç•¥ä¸­é—´é¡µç 
   - ä¾‹å¦‚ï¼š1 2 3 ... 8 9 10

## æ€»ç»“

### å·²å®Œæˆ
1. âœ… åˆ›å»ºé€šç”¨æˆ˜æŠ¥ç»„ä»¶
2. âœ… æ›´æ–°é—¯å¡”æˆ˜æŠ¥é¡µé¢ï¼Œæ·»åŠ åˆ†é¡µåŠŸèƒ½
3. âœ… æ”¯æŒæ¯é¡µ10ä¸ªå›åˆ
4. âœ… æ”¯æŒä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µå¯¼èˆª
5. âœ… æ”¯æŒé¡µç å¿«é€Ÿè·³è½¬
6. âœ… æ˜¾ç¤ºæ‰£è¡€æ•°å€¼
7. âœ… é¡µæ•°æ— ä¸Šé™

### å¾…ä¼˜åŒ–
1. â³ ä¸ºå…¶ä»–æˆ˜æ–—åœºæ™¯æ·»åŠ åˆ†é¡µåŠŸèƒ½
2. â³ ç»Ÿä¸€æ‰€æœ‰æˆ˜æŠ¥çš„æ•°æ®æ ¼å¼
3. â³ æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹Ÿæ»šåŠ¨ï¼‰

### ä¼˜ç‚¹
1. âœ… åˆ†é¡µæ¸…æ™°ï¼Œæ˜“äºæŸ¥çœ‹
2. âœ… æ”¯æŒå¿«é€Ÿè·³è½¬
3. âœ… æ‰£è¡€æ•°å€¼æ˜ç¡®æ˜¾ç¤º
4. âœ… é¡µæ•°æ— ä¸Šé™
5. âœ… ä»£ç å¯å¤ç”¨

**é—¯å¡”æˆ˜æŠ¥åˆ†é¡µåŠŸèƒ½å·²å®ç°ï¼Œå…¶ä»–æˆ˜æ–—åœºæ™¯å¯å‚è€ƒæ­¤å®ç°æ·»åŠ åˆ†é¡µï¼** ğŸ‰
